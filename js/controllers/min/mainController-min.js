!function($){angular.module("rakugaki").controller("MainController",function($rootScope,$scope,$timeout,$state,$stateParams,$window){$scope.loaded=!1,$scope.slides=[{name:"Welcome",state:"welcome",index:0},{name:"Springtide",state:"springtide",index:1},{name:"Shiro",state:"shiro",index:2},{name:"Kcalb",state:"kcalb",index:3},{name:"Yabu no Naka",state:"yabu",index:4},{name:"About",state:"about",index:5}],$scope.currentSlide=0,$scope.numSlides=$scope.slides.length,$scope.transitionAnimation="init",$scope.swipeDisabled=!1,$scope.keyDisabled=!1,$scope.inTransition=!1,$scope.modalShown=!1,$scope.sidebarShown=!1,$scope.infoWindowShown=!1,$scope.slideIndexShown=!1,$scope.safeApply=function(fn,callback){var phase=this.$root.$$phase;"$apply"==phase||"$digest"==phase?fn&&"function"==typeof fn&&fn():(this.$apply(fn),callback&&callback())},$scope.gotoSlide=function(slide,$event){if(!$scope.modalShown&&!$scope.inTransition){if($state.$current.name==slide)return $scope.closeInfoWindow(),void $scope.closePopup($event);$scope.inTransition=!0,$scope.closeInfoWindow(),$scope.closePopup($event),$scope.safeApply(function(){"init"!=$scope.transitionAnimation&&($scope.transitionAnimation="init")}),$timeout(function(){$state.go(slide)},320)}},$scope.nextSlide=function(){$scope.modalShown||$scope.inTransition||($scope.inTransition=!0,$scope.closeInfoWindow(),$scope.safeApply(function(){"next"!=$scope.transitionAnimation&&($scope.transitionAnimation="next")}),$scope.currentSlide===$scope.slides.length-1?$scope.currentSlide=0:$scope.currentSlide++,$timeout(function(){$state.go($scope.slides[$scope.currentSlide].state)},100))},$scope.prevSlide=function(){$scope.modalShown||$scope.inTransition||($scope.inTransition=!0,$scope.closeInfoWindow(),$scope.safeApply(function(){"prev"!=$scope.transitionAnimation&&($scope.transitionAnimation="prev")}),0===$scope.currentSlide?$scope.currentSlide=$scope.slides.length-1:$scope.currentSlide--,$timeout(function(){$state.go($scope.slides[$scope.currentSlide].state)},100))},$scope.openSidebar=function($event){$event.stopPropagation(),$event.preventDefault(),$(".nav-trigger").fadeOut(),$("#st-container").className="st-container",$timeout(function(){$scope.sidebarShown=!0},25)},$scope.closePopup=function($event){$event.stopPropagation(),$scope.sidebarShown&&($scope.sidebarShown=!1,$timeout(function(){$(".nav-trigger").fadeIn()},500)),$scope.slideIndexShown&&($scope.slideIndexShown=!1,$(".slide-index").fadeOut())},$scope.prenventPropagation=function($event){$event.stopPropagation()},$scope.openInfoWindow=function(){$scope.infoWindowShown=!0,$("#info-"+$scope.slides[$scope.currentSlide].state).addClass("show"),$scope.slideIndexShown=!1,$(".slide-index").fadeOut()},$scope.closeInfoWindow=function(){$scope.infoWindowShown=!1,$(".works-info").removeClass("show")},$scope.tapAnime=function(tap_xpos,tap_ypos){$(".plot").css("visibility","visible");var offset=5;$(".plot").css("width","30px"),$(".plot").css("height","30px"),$(".plot").css("left",tap_xpos-15+"px"),$(".plot").css("top",tap_ypos-15+"px"),$(".plot").css({opacity:.3}),$(".plot").animate({opacity:0,height:"40px",width:"40px",left:"-="+offset+"px",top:"-="+offset+"px"},300,function(){$(".plot").css("visibility","hidden")})},$scope.initTapAnime=function(){$(".st-pusher, .trigger, .md-trigger, .md-modal").on("click",function($event){$scope.tapAnime($event.pageX,$event.pageY)})},$scope.openSlideIndex=function($event){$event.stopPropagation(),$scope.slideIndexShown=!0,$(".slide-index").fadeIn(),$scope.closeInfoWindow()},$scope.initPerfectScrollbar=function(){$(".works-info-content-wrapper, .slide-index").perfectScrollbar()},$scope.key=function($event){37==$event.keyCode?$scope.prevSlide():39==$event.keyCode&&$scope.nextSlide()},$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams){$scope.currentSlide=$state.current.data.index}),$scope.$on("$includeContentLoaded",function(){$scope.initPerfectScrollbar()}),$scope.init=function(){$timeout(function(){$scope.initTapAnime(),$scope.loaded=!0},100)},$scope.init()})}(jQuery,angular);